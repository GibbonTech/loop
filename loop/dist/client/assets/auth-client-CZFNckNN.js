var Te=Object.defineProperty;var Pe=(e,t,r)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var $=(e,t,r)=>Pe(e,typeof t!="symbol"?t+"":t,r);import{r as K}from"./main-6fd-8Eiz.js";var Le={},ce={};const X=Object.create(null),V=e=>{var t;return Le||((t=globalThis.Deno)==null?void 0:t.env.toObject())||globalThis.__env__||(e?X:globalThis)},T=new Proxy(X,{get(e,t){return V()[t]??X[t]},has(e,t){return t in V()||t in X},set(e,t,r){const n=V(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=V(!0);return delete r[t],!0},ownKeys(){const e=V(!0);return Object.keys(e)}});function v(e,t){return typeof process<"u"&&ce?ce[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const G=1,b=4,x=8,_=24,le={eterm:b,cons25:b,console:b,cygwin:b,dtterm:b,gnome:b,hurd:b,jfbterm:b,konsole:b,kterm:b,mlterm:b,mosh:_,putty:b,st:b,"rxvt-unicode-24bit":_,terminator:_,"xterm-kitty":_},Ae=new Map(Object.entries({APPVEYOR:x,BUILDKITE:x,CIRCLECI:_,DRONE:x,GITEA_ACTIONS:_,GITHUB_ACTIONS:_,GITLAB_CI:x,TRAVIS:x})),Ie=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Ue(){if(v("FORCE_COLOR")!==void 0)switch(v("FORCE_COLOR")){case"":case"1":case"true":return b;case"2":return x;case"3":return _;default:return G}if(v("NODE_DISABLE_COLORS")!==void 0&&v("NODE_DISABLE_COLORS")!==""||v("NO_COLOR")!==void 0&&v("NO_COLOR")!==""||v("TERM")==="dumb")return G;if(v("TMUX"))return _;if("TF_BUILD"in T&&"AGENT_NAME"in T)return b;if("CI"in T){for(const{0:e,1:t}of Ae)if(e in T)return t;return v("CI_NAME")==="codeship"?x:G}if("TEAMCITY_VERSION"in T)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(v("TEAMCITY_VERSION"))!==null?b:G;switch(v("TERM_PROGRAM")){case"iTerm.app":return!v("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(v("TERM_PROGRAM_VERSION"))!==null?x:_;case"HyperTerm":case"MacTerm":return _;case"Apple_Terminal":return x}if(v("COLORTERM")==="truecolor"||v("COLORTERM")==="24bit")return _;if(v("TERM")){if(/truecolor/.exec(v("TERM"))!==null)return _;if(/^xterm-256/.exec(v("TERM"))!==null)return x;const e=v("TERM").toLowerCase();if(le[e])return le[e];if(Ie.some(t=>t.exec(e)!==null))return b}return v("COLORTERM")?b:G}const N={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},oe=["debug","info","success","warn","error"];function Ce(e,t){return oe.indexOf(t)>=oe.indexOf(e)}const xe={info:N.fg.blue,success:N.fg.green,warn:N.fg.yellow,error:N.fg.red,debug:N.fg.magenta},Ne=(e,t,r)=>{const n=new Date().toISOString();return r?`${N.dim}${n}${N.reset} ${xe[e]}${e.toUpperCase()}${N.reset} ${N.bright}[Better Auth]:${N.reset} ${t}`:`${n} ${e.toUpperCase()} [Better Auth]: ${t}`},Me=e=>{const t="error",r=Ue()!==1,n=(s,u,o=[])=>{if(!Ce(t,s))return;const l=Ne(s,u,r);{s==="error"?console.error(l,...o):s==="warn"?console.warn(l,...o):console.log(l,...o);return}};return{...Object.fromEntries(oe.map(s=>[s,(...[u,...o])=>n(s,u,o)])),get level(){return t}}};Me();function Be(e){return e.charAt(0).toUpperCase()+e.slice(1)}var W=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function Fe(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new W(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function qe(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new W(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof W?t:new W(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function ee(e,t="/api/auth"){if(qe(e),Fe(e))return e;const r=e.replace(/\/+$/,"");return!t||t==="/"?r:(t=t.startsWith("/")?t:`/${t}`,`${r}${t}`)}function De(e,t,r,n,s){if(e)return ee(e,t);{const u=T.BETTER_AUTH_URL||T.NEXT_PUBLIC_BETTER_AUTH_URL||T.PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_AUTH_URL||(T.BASE_URL!=="/"?T.BASE_URL:void 0);if(u)return ee(u,t)}if(typeof window<"u"&&window.location)return ee(window.location.origin,t)}const $e={id:"redirect",name:"Redirect",hooks:{onSuccess(e){var t,r;if((t=e.data)!=null&&t.url&&((r=e.data)!=null&&r.redirect)&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},ke={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},je=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,fe={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Ve=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function Ge(e){return e instanceof Date&&!isNaN(e.getTime())}function We(e){const t=Ve.exec(e);if(!t)return null;const[,r,n,s,u,o,l,i,a,c,d]=t;let g=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(s,10),parseInt(u,10),parseInt(o,10),parseInt(l,10),i?parseInt(i.padEnd(3,"0"),10):0));if(a){const w=(parseInt(c,10)*60+parseInt(d,10))*(a==="+"?-1:1);g.setUTCMinutes(g.getUTCMinutes()+w)}return Ge(g)?g:null}function He(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:s,parseDates:u=!0}=t;if(typeof e!="string")return e;const o=e.trim();if(o.length>0&&o[0]==='"'&&o.endsWith('"')&&!o.slice(1,-1).includes('"'))return o.slice(1,-1);const l=o.toLowerCase();if(l.length<=9&&l in fe)return fe[l];if(!je.test(o)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(ke).some(([i,a])=>{const c=a.test(o);return c&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),c})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(o,(a,c)=>{if(a==="__proto__"||a==="constructor"&&c&&typeof c=="object"&&"prototype"in c){n&&console.warn(`[better-json] Dropping "${a}" key to prevent prototype pollution`);return}if(u&&typeof c=="string"){const d=We(c);if(d)return d}return s?s(a,c):c})}catch(i){if(r)throw i;return e}}function Je(e,t={strict:!0}){return He(e,t)}let I=[],q=0;const J=4,ve=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let u=q+J;u<I.length;)I[u]===n?I.splice(u,J):u+=J;let s=t.indexOf(n);~s&&(t.splice(s,1),--r.lc||r.off())}},notify(n,s){let u=!I.length;for(let o of t)I.push(o,r.value,n,s);if(u){for(q=0;q<I.length;q+=J)I[q](I[q+1],I[q+2],I[q+3]);I.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n){let s=r.listen(n);return n(r.value),s},value:e};return r},Ye=5,Y=6,z=10;let ze=(e,t,r,n)=>(e.events=e.events||{},e.events[r+z]||(e.events[r+z]=n(s=>{e.events[r].reduceRight((u,o)=>(o(u),u),{shared:{},...s})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let s=e.events[r],u=s.indexOf(t);s.splice(u,1),s.length||(delete e.events[r],e.events[r+z](),delete e.events[r+z])}),Xe=1e3,be=(e,t)=>ze(e,n=>{let s=t(n);s&&e.events[Y].push(s)},Ye,n=>{let s=e.listen;e.listen=(...o)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...o));let u=e.off;return e.events[Y]=[],e.off=()=>{u(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let o of e.events[Y])o();e.events[Y]=[]}},Xe)},()=>{e.listen=s,e.off=u}});function Qe(e,t,r){let n=new Set(t).add(void 0);return e.listen((s,u,o)=>{n.has(o)&&r(s,u,o)})}const Ze=()=>typeof window>"u",Ke=(e,t,r,n)=>{const s=ve({data:null,error:null,isPending:!0,isRefetching:!1,refetch:l=>u(l)}),u=async l=>new Promise(i=>{const a=typeof n=="function"?n({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):n;r(t,{...a,query:{...a==null?void 0:a.query,...l==null?void 0:l.query},async onSuccess(c){var d;s.set({data:c.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((d=a==null?void 0:a.onSuccess)==null?void 0:d.call(a,c))},async onError(c){var O,P;const{request:d}=c,g=typeof d.retry=="number"?d.retry:(O=d.retry)==null?void 0:O.attempts,w=d.retryAttempt||0;g&&w<g||(s.set({error:c.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await((P=a==null?void 0:a.onError)==null?void 0:P.call(a,c)))},async onRequest(c){var g;const d=s.get();s.set({isPending:d.data===null,data:d.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await((g=a==null?void 0:a.onRequest)==null?void 0:g.call(a,c))}}).catch(c=>{s.set({error:c,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{i(void 0)})});e=Array.isArray(e)?e:[e];let o=!1;for(const l of e)l.subscribe(async()=>{Ze()||(o?await u():be(s,()=>{const i=setTimeout(async()=>{o||(await u(),o=!0)},0);return()=>{s.off(),l.off(),clearTimeout(i)}}))});return s},te=Symbol.for("better-auth:broadcast-channel"),et=()=>Math.floor(Date.now()/1e3);var tt=class{constructor(e="better-auth.message"){$(this,"listeners",new Set);$(this,"name");this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:et()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const r=JSON.parse(t.newValue??"{}");(r==null?void 0:r.event)!=="session"||!(r!=null&&r.data)||this.listeners.forEach(n=>n(r))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function re(e="better-auth.message"){return globalThis[te]||(globalThis[te]=new tt(e)),globalThis[te]}const ne=Symbol.for("better-auth:focus-manager");var rt=class{constructor(){$(this,"listeners",new Set)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function de(){return globalThis[ne]||(globalThis[ne]=new rt),globalThis[ne]}const se=Symbol.for("better-auth:online-manager");var nt=class{constructor(){$(this,"listeners",new Set);$(this,"isOnline",typeof navigator<"u"?navigator.onLine:!0)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function ie(){return globalThis[se]||(globalThis[se]=new nt),globalThis[se]}const k=()=>Math.floor(Date.now()/1e3),st=5;function it(e){var L,S,m;const{sessionAtom:t,sessionSignal:r,$fetch:n,options:s={}}=e,u=((L=s.sessionOptions)==null?void 0:L.refetchInterval)??0,o=((S=s.sessionOptions)==null?void 0:S.refetchOnWindowFocus)??!0,l=((m=s.sessionOptions)==null?void 0:m.refetchWhenOffline)??!1,i={lastSync:0,lastSessionRequest:0,cachedSession:void 0},a=()=>l||ie().isOnline,c=y=>{if(!a())return;if((y==null?void 0:y.event)==="storage"){i.lastSync=k(),r.set(!r.get());return}const f=t.get();if((y==null?void 0:y.event)==="poll"){i.lastSessionRequest=k(),n("/get-session").then(A=>{A.error?t.set({...f,data:null,error:A.error}):t.set({...f,data:A.data,error:null}),i.lastSync=k(),r.set(!r.get())}).catch(()=>{});return}(y==null?void 0:y.event)==="visibilitychange"&&k()-i.lastSessionRequest<st&&(f==null?void 0:f.data)!==null&&(f==null?void 0:f.data)!==void 0||((f==null?void 0:f.data)===null||(f==null?void 0:f.data)===void 0||(y==null?void 0:y.event)==="visibilitychange")&&((y==null?void 0:y.event)==="visibilitychange"&&(i.lastSessionRequest=k()),i.lastSync=k(),r.set(!r.get()))},d=y=>{re().post({event:"session",data:{trigger:y},clientId:Math.random().toString(36).substring(7)})},g=()=>{u&&u>0&&(i.pollInterval=setInterval(()=>{var y;(y=t.get())!=null&&y.data&&c({event:"poll"})},u*1e3))},w=()=>{i.unsubscribeBroadcast=re().subscribe(()=>{c({event:"storage"})})},O=()=>{o&&(i.unsubscribeFocus=de().subscribe(()=>{c({event:"visibilitychange"})}))},P=()=>{i.unsubscribeOnline=ie().subscribe(y=>{y&&c({event:"visibilitychange"})})};return{init:()=>{g(),w(),O(),P(),re().setup(),de().setup(),ie().setup()},cleanup:()=>{i.pollInterval&&(clearInterval(i.pollInterval),i.pollInterval=void 0),i.unsubscribeBroadcast&&(i.unsubscribeBroadcast(),i.unsubscribeBroadcast=void 0),i.unsubscribeFocus&&(i.unsubscribeFocus(),i.unsubscribeFocus=void 0),i.unsubscribeOnline&&(i.unsubscribeOnline(),i.unsubscribeOnline=void 0),i.lastSync=0,i.lastSessionRequest=0,i.cachedSession=void 0},triggerRefetch:c,broadcastSessionUpdate:d}}function ot(e,t){const r=ve(!1),n=Ke(r,"/get-session",e,{method:"GET"});return be(n,()=>{const s=it({sessionAtom:n,sessionSignal:r,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:n,$sessionSignal:r}}var at=Object.defineProperty,ut=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,ge=(e,t,r)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,U=(e,t)=>{for(var r in t||(t={}))lt.call(t,r)&&ge(e,r,t[r]);if(he)for(var r of he(t))ft.call(t,r)&&ge(e,r,t[r]);return e},C=(e,t)=>ut(e,ct(t)),dt=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r,Error.captureStackTrace(this,this.constructor)}},ht=async(e,t)=>{var r,n,s,u,o,l;let i=t||{};const a={onRequest:[t==null?void 0:t.onRequest],onResponse:[t==null?void 0:t.onResponse],onSuccess:[t==null?void 0:t.onSuccess],onError:[t==null?void 0:t.onError],onRetry:[t==null?void 0:t.onRetry]};if(!t||!(t!=null&&t.plugins))return{url:e,options:i,hooks:a};for(const c of(t==null?void 0:t.plugins)||[]){if(c.init){const d=await((r=c.init)==null?void 0:r.call(c,e.toString(),t));i=d.options||i,e=d.url}a.onRequest.push((n=c.hooks)==null?void 0:n.onRequest),a.onResponse.push((s=c.hooks)==null?void 0:s.onResponse),a.onSuccess.push((u=c.hooks)==null?void 0:u.onSuccess),a.onError.push((o=c.hooks)==null?void 0:o.onError),a.onRetry.push((l=c.hooks)==null?void 0:l.onRetry)}return{url:e,options:i,hooks:a}},ye=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},gt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function yt(e){if(typeof e=="number")return new ye({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ye(e);case"exponential":return new gt(e);default:throw new Error("Invalid retry strategy")}}var mt=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e!=null&&e.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const[n,s]=await Promise.all([r(e.auth.username),r(e.auth.password)]);if(!n||!s)return t;t.authorization=`Basic ${btoa(`${n}:${s}`)}`}else if(e.auth.type==="Custom"){const[n,s]=await Promise.all([r(e.auth.prefix),r(e.auth.value)]);if(!s)return t;t.authorization=`${n??""} ${s}`}}return t},pt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function vt(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return pt.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function bt(e){try{return JSON.parse(e),!0}catch{return!1}}function ae(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function me(e){try{return JSON.parse(e)}catch{return e}}function pe(e){return typeof e=="function"}function wt(e){if(e!=null&&e.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&pe(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&pe(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Rt(e){const t=new Headers(e==null?void 0:e.headers),r=await mt(e);for(const[n,s]of Object.entries(r||{}))t.set(n,s);if(!t.has("content-type")){const n=Ot(e==null?void 0:e.body);n&&t.set("content-type",n)}return t}function Ot(e){return ae(e)?"application/json":null}function _t(e){if(!(e!=null&&e.body))return null;const t=new Headers(e==null?void 0:e.headers);if(ae(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e==null?void 0:e.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return t.has("content-type")&&t.get("content-type")==="application/x-www-form-urlencoded"&&ae(e.body)?new URLSearchParams(e.body).toString():e.body}function St(e,t){var r;if(t!=null&&t.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return Re.includes(n)?n.toUpperCase():t!=null&&t.body?"POST":"GET"}return t!=null&&t.body?"POST":"GET"}function Et(e,t){let r;return!(e!=null&&e.signal)&&(e!=null&&e.timeout)&&(r=setTimeout(()=>t==null?void 0:t.abort(),e==null?void 0:e.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var Tt=class we extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,we.prototype)}};async function Q(e,t){const r=await e["~standard"].validate(t);if(r.issues)throw new Tt(r.issues);return r.value}var Re=["get","post","put","patch","delete"],Pt=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,s,u,o;const l=((s=(n=e.plugins)==null?void 0:n.find(i=>{var a;return(a=i.schema)!=null&&a.config?t.startsWith(i.schema.config.baseURL||"")||t.startsWith(i.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(l){let i=t;(u=l.config)!=null&&u.prefix&&i.startsWith(l.config.prefix)&&(i=i.replace(l.config.prefix,""),l.config.baseURL&&(t=t.replace(l.config.prefix,l.config.baseURL))),(o=l.config)!=null&&o.baseURL&&i.startsWith(l.config.baseURL)&&(i=i.replace(l.config.baseURL,""));const a=l.schema[i];if(a){let c=C(U({},r),{method:a.method,output:a.output});return r!=null&&r.disableValidation||(c=C(U({},c),{body:a.input?await Q(a.input,r==null?void 0:r.body):r==null?void 0:r.body,params:a.params?await Q(a.params,r==null?void 0:r.params):r==null?void 0:r.params,query:a.query?await Q(a.query,r==null?void 0:r.query):r==null?void 0:r.query})),{url:t,options:c}}}return{url:t,options:r}}}),Lt=e=>{async function t(r,n){const s=C(U(U({},e),n),{plugins:[...(e==null?void 0:e.plugins)||[],Pt(e||{}),...(n==null?void 0:n.plugins)||[]]});if(e!=null&&e.catchAllError)try{return await ue(r,s)}catch(u){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:u}}}return await ue(r,s)}return t};function At(e,t){const{baseURL:r,params:n,query:s}=t||{query:{},params:{},baseURL:""};let u=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const d=e.toString().split("@")[1].split("/")[0];Re.includes(d)&&(e=e.replace(`@${d}/`,"/"))}u.endsWith("/")||(u+="/");let[o,l]=e.replace(u,"").split("?");const i=new URLSearchParams(l);for(const[d,g]of Object.entries(s||{})){if(g==null)continue;let w;if(typeof g=="string")w=g;else if(Array.isArray(g)){for(const O of g)i.append(d,O);continue}else w=JSON.stringify(g);i.set(d,w)}if(n)if(Array.isArray(n)){const d=o.split("/").filter(g=>g.startsWith(":"));for(const[g,w]of d.entries()){const O=n[g];o=o.replace(w,O)}}else for(const[d,g]of Object.entries(n))o=o.replace(`:${d}`,String(g));o=o.split("/").map(encodeURIComponent).join("/"),o.startsWith("/")&&(o=o.slice(1));let a=i.toString();return a=a.length>0?`?${a}`.replace(/\+/g,"%20"):"",u.startsWith("http")?new URL(`${o}${a}`,u):`${u}${o}${a}`}var ue=async(e,t)=>{var r,n,s,u,o,l,i,a;const{hooks:c,url:d,options:g}=await ht(e,t),w=wt(g),O=new AbortController,P=(r=g.signal)!=null?r:O.signal,p=At(d,g),F=_t(g),L=await Rt(g),S=St(d,g);let m=C(U({},g),{url:p,headers:L,body:F,method:S,signal:P});for(const E of c.onRequest)if(E){const R=await E(m);typeof R=="object"&&R!==null&&(m=R)}("pipeTo"in m&&typeof m.pipeTo=="function"||typeof((n=t==null?void 0:t.body)==null?void 0:n.pipe)=="function")&&("duplex"in m||(m.duplex="half"));const{clearTimeout:y}=Et(g,O);let f=await w(m.url,m);y();const A={response:f,request:m};for(const E of c.onResponse)if(E){const R=await E(C(U({},A),{response:(s=t==null?void 0:t.hookOptions)!=null&&s.cloneResponse?f.clone():f}));R instanceof Response?f=R:typeof R=="object"&&R!==null&&(f=R.response)}if(f.ok){if(!(m.method!=="HEAD"))return{data:"",error:null};const R=vt(f),M={data:null,response:f,request:m};if(R==="json"||R==="text"){const B=await f.text(),Ee=(u=m.jsonParser)!=null?u:me;M.data=await Ee(B)}else M.data=await f[R]();m!=null&&m.output&&m.output&&!m.disableValidation&&(M.data=await Q(m.output,M.data));for(const B of c.onSuccess)B&&await B(C(U({},M),{response:(o=t==null?void 0:t.hookOptions)!=null&&o.cloneResponse?f.clone():f}));return t!=null&&t.throw?M.data:{data:M.data,error:null}}const H=(l=t==null?void 0:t.jsonParser)!=null?l:me,D=await f.text(),j=bt(D),h=j?await H(D):null,Z={response:f,responseText:D,request:m,error:C(U({},h),{status:f.status,statusText:f.statusText})};for(const E of c.onError)E&&await E(C(U({},Z),{response:(i=t==null?void 0:t.hookOptions)!=null&&i.cloneResponse?f.clone():f}));if(t!=null&&t.retry){const E=yt(t.retry),R=(a=t.retryAttempt)!=null?a:0;if(await E.shouldAttemptRetry(R,f)){for(const B of c.onRetry)B&&await B(A);const M=E.getDelay(R);return await new Promise(B=>setTimeout(B,M)),await ue(e,C(U({},t),{retryAttempt:R+1}))}}if(t!=null&&t.throw)throw new dt(f.status,f.statusText,j?h:D);return{data:null,error:C(U({},h),{status:f.status,statusText:f.statusText})}};const It=(e,t)=>{var m,y,f,A,H,D,j;const r="credentials"in Request.prototype,n=De(e==null?void 0:e.baseURL,e==null?void 0:e.basePath)??"/api/auth",s=((m=e==null?void 0:e.plugins)==null?void 0:m.flatMap(h=>h.fetchPlugins).filter(h=>h!==void 0))||[],u={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:(y=e==null?void 0:e.fetchOptions)==null?void 0:y.onSuccess,onError:(f=e==null?void 0:e.fetchOptions)==null?void 0:f.onError,onRequest:(A=e==null?void 0:e.fetchOptions)==null?void 0:A.onRequest,onResponse:(H=e==null?void 0:e.fetchOptions)==null?void 0:H.onResponse}},{onSuccess:o,onError:l,onRequest:i,onResponse:a,...c}=(e==null?void 0:e.fetchOptions)||{},d=Lt({baseURL:n,...r?{credentials:"include"}:{},method:"GET",jsonParser(h){return h?Je(h,{strict:!1}):null},customFetchImpl:fetch,...c,plugins:[u,...c.plugins||[],...e!=null&&e.disableDefaultFetchPlugins?[]:[$e],...s]}),{$sessionSignal:g,session:w}=ot(d,e),O=(e==null?void 0:e.plugins)||[];let P={},p={$sessionSignal:g,session:w},F={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const L=[{signal:"$sessionSignal",matcher(h){return h==="/sign-out"||h==="/update-user"||h==="/sign-up/email"||h==="/sign-in/email"||h==="/delete-user"||h==="/verify-email"||h==="/revoke-sessions"||h==="/revoke-session"||h==="/change-email"}}];for(const h of O)h.getAtoms&&Object.assign(p,(D=h.getAtoms)==null?void 0:D.call(h,d)),h.pathMethods&&Object.assign(F,h.pathMethods),h.atomListeners&&L.push(...h.atomListeners);const S={notify:h=>{p[h].set(!p[h].get())},listen:(h,Z)=>{p[h].subscribe(Z)},atoms:p};for(const h of O)h.getActions&&Object.assign(P,(j=h.getActions)==null?void 0:j.call(h,d,S,e));return{get baseURL(){return n},pluginsActions:P,pluginsAtoms:p,pluginPathMethods:F,atomListeners:L,$fetch:d,$store:S}};function Ut(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Ct(e,t,r){const n=t[e],{fetchOptions:s,query:u,...o}=r||{};return n||(s!=null&&s.method?s.method:o&&Object.keys(o).length>0?"POST":"GET")}function xt(e,t,r,n,s){function u(o=[]){return new Proxy(function(){},{get(l,i){if(typeof i!="string"||i==="then"||i==="catch"||i==="finally")return;const a=[...o,i];let c=e;for(const d of a)if(c&&typeof c=="object"&&d in c)c=c[d];else{c=void 0;break}return typeof c=="function"||Ut(c)?c:u(a)},apply:async(l,i,a)=>{const c="/"+o.map(L=>L.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),d=a[0]||{},g=a[1]||{},{query:w,fetchOptions:O,...P}=d,p={...g,...O},F=Ct(c,r,d);return await t(c,{...p,body:F==="GET"?void 0:{...P,...(p==null?void 0:p.body)||{}},query:w||(p==null?void 0:p.query),method:F,async onSuccess(L){var m;if(await((m=p==null?void 0:p.onSuccess)==null?void 0:m.call(p,L)),!s||p.disableSignal)return;const S=s.filter(y=>y.matcher(c));if(S.length)for(const y of S){const f=n[y.signal];if(!f)return;const A=f.get();setTimeout(()=>{f.set(!A)},10)}}})}})}return u()}function Nt(e,t={}){let r=K.useRef(e.get());const{keys:n,deps:s=[e,n]}=t;let u=K.useCallback(l=>{const i=a=>{r.current!==a&&(r.current=a,l())};return i(e.value),n!=null&&n.length?Qe(e,n,i):e.listen(i)},s),o=()=>r.current;return K.useSyncExternalStore(u,o,o)}function Mt(e){return`use${Be(e)}`}function Bt(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:s,$store:u,atomListeners:o}=It(e);let l={};for(const[i,a]of Object.entries(n))l[Mt(i)]=()=>Nt(a);return xt({...r,...l,$fetch:s,$store:u},s,t,n,o)}function Ft(e){return{authorize(t,r="AND"){let n=!1;for(const[s,u]of Object.entries(t)){const o=e[s];if(!o)return{success:!1,error:`You are not allowed to access resource: ${s}`};if(Array.isArray(u))n=u.every(l=>o.includes(l));else if(typeof u=="object"){const l=u;l.connector==="OR"?n=l.actions.some(i=>o.includes(i)):n=l.actions.every(i=>o.includes(i))}else throw new W("Invalid access control request");if(n&&r==="OR")return{success:n};if(!n&&r==="AND")return{success:!1,error:`unauthorized to access resource "${s}"`}}return n?{success:n}:{success:!1,error:"Not authorized"}},statements:e}}function qt(e){return{newRole(t){return Ft(t)},statements:e}}const Dt={user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]},Oe=qt(Dt),_e=Oe.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),Se=Oe.newRole({user:[],session:[]}),$t={admin:_e,user:Se},kt=e=>{var n,s,u,o,l,i;if(e.userId&&((s=(n=e.options)==null?void 0:n.adminUserIds)!=null&&s.includes(e.userId)))return!0;if(!e.permissions&&!e.permission)return!1;const t=(e.role||((u=e.options)==null?void 0:u.defaultRole)||"user").split(","),r=((o=e.options)==null?void 0:o.roles)||$t;for(const a of t)if((i=(l=r[a])==null?void 0:l.authorize(e.permission??e.permissions))!=null&&i.success)return!0;return!1},jt=e=>{const t={admin:_e,user:Se,...e==null?void 0:e.roles};return{id:"admin-client",$InferServerPlugin:{},getActions:()=>({admin:{checkRolePermission:r=>kt({role:r.role,options:{ac:e==null?void 0:e.ac,roles:t},permissions:r.permissions??r.permission})}}),pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}}},Vt=Bt({baseURL:typeof window<"u"?window.location.origin:"http://localhost:3001",plugins:[jt()]}),{signIn:Ht,signUp:Jt,signOut:Yt,useSession:zt,getSession:Xt}=Vt;export{Yt as a,Ht as s,zt as u};
